<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Nurseroom DBMS - Patient Records</title>
  <link rel="stylesheet" href="css/styles.css">
</head>
<body>
  <!-- Global Navigation Bar -->
  <nav class="glass-box">
    <a href="main-menu.html">Home</a>
    <a href="patient-records.html">Patient Records</a>
    <a href="add-sickness.html">Add Sickness Record</a>
    <a href="summary.html">Summary</a>
    <a href="manage-users.html">Manage Users</a>
    <a href="admin-dashboard.html">Admin Dashboard</a>
    <a href="logout.html" id="logout">Logout</a>
  </nav>
  
  <div class="glass-box" style="margin: 20px;">
    <h2>Patient Records</h2>
    <table id="patientsTable" border="1" cellspacing="0" cellpadding="10">
      <thead>
        <tr>
          <th>Patient ID</th>
          <th>Student ID</th>
          <th>Name</th>
          <th>Class</th>
          <th>Date of Birth</th>
          <th>Age</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <!-- Records will be dynamically loaded here -->
      </tbody>
    </table>
  </div>
  
  <script src="js/dbSimulator.js"></script>
  <script>
    // Check for an active session
    const user = JSON.parse(localStorage.getItem('user'));
    if (!user) {
      window.location.href = 'index.html';
    }
    
    // Load patients from JSON and populate the table
    loadJSON('data/patients.json')
      .then(patients => {
        const tbody = document.getElementById('patientsTable').getElementsByTagName('tbody')[0];
        patients.forEach(patient => {
          const tr = document.createElement('tr');
          tr.innerHTML = `
            <td>${patient.patientId}</td>
            <td>${patient.studentId}</td>
            <td><a href="patient-details.html?id=${patient.patientId}" style="color: #fff;">${patient.name}</a></td>
            <td>${patient.class}</td>
            <td>${patient.dob}</td>
            <td>${patient.age}</td>
            <td>
              <button onclick="editPatient('${patient.patientId}')">Edit</button>
              <button onclick="deletePatient('${patient.patientId}')">Delete</button>
            </td>
          `;
          tbody.appendChild(tr);
        });
      })
      .catch(error => console.error('Error loading patients:', error));
    
    // Fully functional edit and delete functions:
    function editPatient(patientId) {
      // Redirect to an edit page (create edit-patient.html similarly)
      window.location.href = `edit-patient.html?id=${patientId}`;
    }
    
    function deletePatient(patientId) {
      if (confirm('Are you sure you want to delete this patient?')) {
        loadJSON('data/patients.json')
          .then(patients => {
            const updatedPatients = patients.filter(patient => patient.patientId !== patientId);
            // In a static site, we simulate deletion by saving updated data in localStorage.
            localStorage.setItem('patients', JSON.stringify(updatedPatients));
            alert('Patient deleted. Refresh the page to see changes.');
          });
      }
    }
    
    // Logout functionality
    document.getElementById('logout').addEventListener('click', function(e) {
      e.preventDefault();
      localStorage.removeItem('user');
      window.location.href = 'index.html';
    });
  </script>
</body>
</html>
